

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Rotate a Key &mdash; Hyperledger Indy SDK  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          


          
            <a href="../../../rtd-index.html" class="icon icon-home"> Hyperledger Indy SDK
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Indy" src="_static/images/indy-logo.png" />
<br>
<a href="https://github.com/hyperledger/indy-sdk.git"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="_static/images/rocketchat_button.png"/></a>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/getting-started.html">Getting Started with Libindy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rtd-tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rtd-design.html">Indy SDK Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rtd-building.html">Building Indy SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rtd-migration-guides.html">Libindy Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-workflow.html">Release process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../signing-commits.html">Signing commits</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../rtd-index.html">Hyperledger Indy SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../rtd-index.html">Docs</a> &raquo;</li>
        
      <li>Rotate a Key</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/how-tos/rotate-key/python/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rotate-a-key">
<span id="rotate-a-key"></span><h1>Rotate a Key<a class="headerlink" href="#rotate-a-key" title="Permalink to this headline">¶</a></h1>
<p>Indy-SDK Developer Walkthrough #2, Python Edition</p>
<p>[ <a class="reference external" href="../java/README.md">Java</a> | <a class="reference external" href="../../not-yet-written.md">.NET</a> | <a class="reference external" href="../../not-yet-written.md">Node.js</a> | <a class="reference external" href="../../not-yet-written.md">Objective C</a> ]</p>
<div class="section" id="prerequisites">
<span id="prerequisites"></span><h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Setup your workstation with an indy development virtual machine (VM). See <a class="reference external" href="../../prerequisites.md">prerequisites</a>.</p>
<p>Ensure you have the 64-bit version of Python 3 installed, as the 32-bit version may have problems loading the Indy .dll files.</p>
</div>
<div class="section" id="steps">
<span id="steps"></span><h2>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h2>
<div class="section" id="step-1">
<span id="step-1"></span><h3>Step 1<a class="headerlink" href="#step-1" title="Permalink to this headline">¶</a></h3>
<p>In your normal workstation operating system (not the VM), open a python editor of your
choice and paste the code from <a class="reference external" href="template.py">template.py</a>
into a new file. We will be modifying this code in later steps.</p>
<p>Save the file as <code class="docutils literal notranslate"><span class="pre">rotate_key.py</span></code>.</p>
<p>Install the required python packages by executing <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">python3-indy</span> <span class="pre">asyncio</span></code></p>
</div>
<div class="section" id="step-2">
<span id="step-2"></span><h3>Step 2<a class="headerlink" href="#step-2" title="Permalink to this headline">¶</a></h3>
<p>This how-to builds on the work in
<a class="reference external" href="../write-did-and-query-verkey/python/README.md">“Write DID and Query Verkey”</a>.
Rather than duplicate our explanation of those steps here, we will simply
copy that code as our starting point.</p>
<p>Copy the contents of <a class="reference external" href="step2.py">step2.py</a> into
<code class="docutils literal notranslate"><span class="pre">rotate_key.py</span></code> instead of the <code class="docutils literal notranslate"><span class="pre">Step</span> <span class="pre">2</span> <span class="pre">code</span> <span class="pre">goes</span> <span class="pre">here</span></code> placeholder comment.</p>
<p>Save the updated version of <code class="docutils literal notranslate"><span class="pre">rotate_key.py</span></code>.</p>
</div>
<div class="section" id="step-3">
<span id="step-3"></span><h3>Step 3<a class="headerlink" href="#step-3" title="Permalink to this headline">¶</a></h3>
<p>Once we have an identity on the ledger, we can rotate its key pair.</p>
<p>Copy the contents of <a class="reference external" href="step3.py">step3.py</a> into
<code class="docutils literal notranslate"><span class="pre">rotate_key.py</span></code> instead of the <code class="docutils literal notranslate"><span class="pre">Step</span> <span class="pre">3</span> <span class="pre">code</span> <span class="pre">goes</span> <span class="pre">here</span></code> placeholder comment.</p>
<p>Save the updated version of <code class="docutils literal notranslate"><span class="pre">rotate_key.py</span></code>.</p>
<p>Most of the logic here should be self-explanatory. However, it’s worth
explaining the paired functions <code class="docutils literal notranslate"><span class="pre">replace_keys_start</span></code> and <code class="docutils literal notranslate"><span class="pre">replace_keys_apply</span></code>.
When we submit the update transaction to the ledger, we have to sign it
using the current signing key; the ledger will verify this using the
verkey that it recognizes. Yet we have to specify the new verkey value
in the transaction itself. The <code class="docutils literal notranslate"><span class="pre">replace_keys_start</span></code> method tells the wallet
that an update is pending, and that it should track both the new and old keypairs
for the identity. The <code class="docutils literal notranslate"><span class="pre">replace_keys_apply</span></code> resolves the pending status
so the new value becomes canonical in the local wallet (after it has
already become canonical on the ledger).</p>
</div>
<div class="section" id="step-4">
<span id="step-4"></span><h3>Step 4<a class="headerlink" href="#step-4" title="Permalink to this headline">¶</a></h3>
<p>Now we can query the ledger to see which verkey it has on record for the
identity.</p>
<p>Copy the contents of <a class="reference external" href="step4.py">step4.py</a> into
<code class="docutils literal notranslate"><span class="pre">rotate_key.py</span></code> instead of the <code class="docutils literal notranslate"><span class="pre">Step</span> <span class="pre">4</span> <span class="pre">code</span> <span class="pre">goes</span> <span class="pre">here</span></code> placeholder comment.</p>
<p>Save the updated version of <code class="docutils literal notranslate"><span class="pre">rotate_key.py</span></code>.</p>
<p>Only a handful of lines of code matter to our goal here; the rest of this
block is comments and boilerplate cleanup <strong>(which you should not omit!)</strong>.</p>
</div>
<div class="section" id="step-5">
<span id="step-5"></span><h3>Step 5<a class="headerlink" href="#step-5" title="Permalink to this headline">¶</a></h3>
<p>Run the completed demo and observe the whole sequence.</p>
</div>
</div>
<div class="section" id="more-experiments">
<span id="more-experiments"></span><h2>More experiments<a class="headerlink" href="#more-experiments" title="Permalink to this headline">¶</a></h2>
<p>You might try the <a class="reference external" href="../../save-schema-and-cred-def/python/README.md">“Save a Schema and Cred Def”</a>
how-to.</p>
</div>
<div class="section" id="common-errors">
<span id="common-errors"></span><h2>Common errors<a class="headerlink" href="#common-errors" title="Permalink to this headline">¶</a></h2>
<p>Error <code class="docutils literal notranslate"><span class="pre">PoolLedgerConfigAlreadyExistsError</span></code>.Delete config before creating:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">await</span> <span class="n">pool</span><span class="o">.</span><span class="n">create_pool_ledger_config</span><span class="p">(</span><span class="n">config_name</span><span class="o">=</span><span class="n">pool_name</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">pool_config</span><span class="p">)</span>
<span class="k">except</span> <span class="n">IndyError</span><span class="p">:</span>
    <span class="n">await</span> <span class="n">pool</span><span class="o">.</span><span class="n">delete_pool_ledger_config</span><span class="p">(</span><span class="n">config_name</span><span class="o">=</span><span class="n">pool_name</span><span class="p">)</span>
    <span class="n">await</span> <span class="n">pool</span><span class="o">.</span><span class="n">create_pool_ledger_config</span><span class="p">(</span><span class="n">config_name</span><span class="o">=</span><span class="n">pool_name</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">pool_config</span><span class="p">)</span>
</pre></div>
</div>
<p>Error <code class="docutils literal notranslate"><span class="pre">WalletAlreadyExistsError</span></code>.Delete wallet before creating:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">await</span> <span class="n">wallet</span><span class="o">.</span><span class="n">create_wallet</span><span class="p">(</span><span class="n">pool_name</span><span class="p">,</span> <span class="n">wallet_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">wallet_credentials</span><span class="p">)</span>
<span class="k">except</span> <span class="n">IndyError</span><span class="p">:</span>
    <span class="n">await</span> <span class="n">wallet</span><span class="o">.</span><span class="n">delete_wallet</span><span class="p">(</span><span class="n">wallet_name</span><span class="p">,</span> <span class="n">wallet_credentials</span><span class="p">)</span>
    <span class="n">await</span> <span class="n">wallet</span><span class="o">.</span><span class="n">create_wallet</span><span class="p">(</span><span class="n">pool_name</span><span class="p">,</span> <span class="n">wallet_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">wallet_credentials</span><span class="p">)</span>
</pre></div>
</div>
<p>Error <code class="docutils literal notranslate"><span class="pre">CommonIOError</span></code>. Make sure that you have set <code class="docutils literal notranslate"><span class="pre">genesis_file_path</span></code> to point
to your <code class="docutils literal notranslate"><span class="pre">indy-sdk/cli/docker_pool_transactions_genesis</span></code>.</p>
<p>Error <code class="docutils literal notranslate"><span class="pre">PoolLedgerTimeout</span></code>. Make sure that the pool of local nodes in Docker is running on the same ip/ports as
in the <code class="docutils literal notranslate"><span class="pre">docker_pool_transactions_genesis</span></code> (for further details see <a class="reference external" href="https://github.com/hyperledger/indy-sdk/blob/master/README.md#how-to-start-local-nodes-pool-with-docker">How to start local nodes pool with docker</a>)</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Hyperledger

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>