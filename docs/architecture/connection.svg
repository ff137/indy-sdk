<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1802.7px" preserveAspectRatio="none" style="width:2510px;height:1802px;" version="1.1" viewBox="0 0 2510 1802" width="2510.9999px" zoomAndPan="magnify"><defs><filter height="300%" id="f77tpco" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.7999999523162842"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.5999999046325684" dy="3.5999999046325684" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="473.4" x2="473.4" y1="34.2888" y2="1769.1666"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="920.25" x2="920.25" y1="34.2888" y2="1769.1666"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="1086.75" x2="1086.75" y1="34.2888" y2="1769.1666"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="1279.8" x2="1279.8" y1="34.2888" y2="1769.1666"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="1481.4" x2="1481.4" y1="34.2888" y2="1769.1666"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421; stroke-dasharray: 5.0,5.0;" x1="1917.4499" x2="1917.4499" y1="34.2888" y2="1769.1666"/><rect fill="#FEFECE" filter="url(#f77tpco)" height="27.0888" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="39.6" x="451.8" y="2.7"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="27" x="458.1" y="20.8187">Alice</text><rect fill="#FEFECE" filter="url(#f77tpco)" height="27.0888" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="39.6" x="451.8" y="1768.2666"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="27" x="458.1" y="1786.3853">Alice</text><rect fill="#FEFECE" filter="url(#f77tpco)" height="27.0888" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="85.5" x="876.15" y="2.7"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="72.9" x="882.45" y="20.8187">Alice Agency</text><rect fill="#FEFECE" filter="url(#f77tpco)" height="27.0888" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="85.5" x="876.15" y="1768.2666"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="72.9" x="882.45" y="1786.3853">Alice Agency</text><rect fill="#FEFECE" filter="url(#f77tpco)" height="27.0888" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="76.5" x="1047.15" y="2.7"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="63.9" x="1053.45" y="20.8187">Alice Agent</text><rect fill="#FEFECE" filter="url(#f77tpco)" height="27.0888" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="76.5" x="1047.15" y="1768.2666"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="63.9" x="1053.45" y="1786.3853">Alice Agent</text><rect fill="#FEFECE" filter="url(#f77tpco)" height="27.0888" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="72" x="1242" y="2.7"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="59.4" x="1248.3" y="20.8187">Bob Agent</text><rect fill="#FEFECE" filter="url(#f77tpco)" height="27.0888" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="72" x="1242" y="1768.2666"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="59.4" x="1248.3" y="1786.3853">Bob Agent</text><rect fill="#FEFECE" filter="url(#f77tpco)" height="27.0888" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="81" x="1439.1" y="2.7"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="68.4" x="1445.4" y="20.8187">Bob Agency</text><rect fill="#FEFECE" filter="url(#f77tpco)" height="27.0888" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="81" x="1439.1" y="1768.2666"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="68.4" x="1445.4" y="1786.3853">Bob Agency</text><rect fill="#FEFECE" filter="url(#f77tpco)" height="27.0888" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="35.1" x="1898.5499" y="2.7"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="22.5" x="1904.8499" y="20.8187">Bob</text><rect fill="#FEFECE" filter="url(#f77tpco)" height="27.0888" style="stroke: #A80036; stroke-width: 1.3499999642372131;" width="35.1" x="1898.5499" y="1768.2666"/><text fill="#000000" font-family="sans-serif" font-size="12.6" lengthAdjust="spacingAndGlyphs" textLength="22.5" x="1904.8499" y="1786.3853">Bob</text><rect fill="#EEEEEE" filter="url(#f77tpco)" height="2.7" style="stroke: #EEEEEE; stroke-width: 0.8999999761581421;" width="2503.7999" x="2.7" y="61.7157"/><line style="stroke: #000000; stroke-width: 0.8999999761581421;" x1="2.7" x2="2506.4999" y1="61.7157" y2="61.7157"/><line style="stroke: #000000; stroke-width: 0.8999999761581421;" x1="2.7" x2="2506.4999" y1="64.4157" y2="64.4157"/><rect fill="#EEEEEE" filter="url(#f77tpco)" height="20.6539" style="stroke: #000000; stroke-width: 1.7999999523162842;" width="88.2" x="1210.5" y="52.2888"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="1215.9" y="66.8632">Provisioning</text><polygon fill="#A80036" points="909.9,96.3426,918.9,99.9426,909.9,103.5426,913.5,99.9426" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="473.4" x2="915.3" y1="99.9426" y2="99.9426"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="425.7" x="479.7" y="96.5171">Provision Alice DID --&gt; Alice Agent DID - will be stored at DIDDoc as routingKeys</text><polygon fill="#A80036" points="1491.3,122.3965,1482.3,125.9965,1491.3,129.5965,1487.7,125.9965" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1485.9" x2="1916.9999" y1="125.9965" y2="125.9965"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="414.9" x="1496.7" y="122.5709">Provision Bob DID --&gt; Bob Agent DID - will be stored at DIDDoc as routingKeys</text><rect fill="#EEEEEE" filter="url(#f77tpco)" height="2.7" style="stroke: #EEEEEE; stroke-width: 0.8999999761581421;" width="2503.7999" x="2.7" y="152.4773"/><line style="stroke: #000000; stroke-width: 0.8999999761581421;" x1="2.7" x2="2506.4999" y1="152.4773" y2="152.4773"/><line style="stroke: #000000; stroke-width: 0.8999999761581421;" x1="2.7" x2="2506.4999" y1="155.1773" y2="155.1773"/><rect fill="#EEEEEE" filter="url(#f77tpco)" height="20.6539" style="stroke: #000000; stroke-width: 1.7999999523162842;" width="68.4" x="1220.4" y="143.0503"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52.2" x="1225.8" y="157.6248">Invitation</text><polygon fill="#A80036" points="1907.0999,225.2388,1916.0999,228.8388,1907.0999,232.4388,1910.6999,228.8388" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="473.4" x2="1912.4999" y1="228.8388" y2="228.8388"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="216" x="479.7" y="225.4133">Share plain `invitation` message with Bob</text><polygon fill="#FBFB77" filter="url(#f77tpco)" points="7.2,177.2042,7.2,266.3042,465.3,266.3042,465.3,186.2042,456.3,177.2042,7.2,177.2042" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="456.3" x2="456.3" y1="177.2042" y2="186.2042"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="465.3" x2="456.3" y1="186.2042" y2="186.2042"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="3.6" x="12.6" y="192.6787">{</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="424.8" x="27" y="206.1325">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/didexchange/1.0/invitation",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="175.5" x="27" y="219.5864">"@id": "12345678900987654321",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="79.2" x="27" y="233.0402">"label": "Alice",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="90" x="27" y="246.4941">"did": "Alice DID"</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="3.6" x="12.6" y="259.9479">}</text><rect fill="#EEEEEE" filter="url(#f77tpco)" height="2.7" style="stroke: #EEEEEE; stroke-width: 0.8999999761581421;" width="2503.7999" x="2.7" y="293.4543"/><line style="stroke: #000000; stroke-width: 0.8999999761581421;" x1="2.7" x2="2506.4999" y1="293.4543" y2="293.4543"/><line style="stroke: #000000; stroke-width: 0.8999999761581421;" x1="2.7" x2="2506.4999" y1="296.1543" y2="296.1543"/><rect fill="#EEEEEE" filter="url(#f77tpco)" height="20.6539" style="stroke: #000000; stroke-width: 1.7999999523162842;" width="128.7" x="1190.25" y="284.0273"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112.5" x="1195.65" y="298.6018">Connection Request</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1917.8999" x2="1955.6999" y1="332.535" y2="332.535"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1955.6999" x2="1955.6999" y1="332.535" y2="344.235"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1918.7999" x2="1955.6999" y1="344.235" y2="344.235"/><polygon fill="#A80036" points="1927.7999,340.635,1918.7999,344.235,1927.7999,347.835,1924.1999,344.235" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="225.9" x="1924.1999" y="328.2557">resolve DIDDoc correspondent to Alice DID</text><polygon fill="#FBFB77" filter="url(#f77tpco)" points="2160.8999,319.5312,2160.8999,341.1312,2493.8999,341.1312,2493.8999,328.5312,2484.8999,319.5312,2160.8999,319.5312" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="2484.8999" x2="2484.8999" y1="319.5312" y2="328.5312"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="2493.8999" x2="2484.8999" y1="328.5312" y2="328.5312"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="314.1" x="2166.2999" y="335.0057">will receive `recipientKeys`, `routingKeys`, `serviceEndpoint`</text><polygon fill="#A80036" points="930.6,410.6966,921.6,414.2966,930.6,417.8966,927,414.2966" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="925.2" x2="1916.9999" y1="414.2966" y2="414.2966"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="291.6" x="936" y="410.8711">Send `request` to `serviceEndpoint` taken from DIDDoc.</text><polygon fill="#FBFB77" filter="url(#f77tpco)" points="1922.3999,355.935,1922.3999,458.535,2411.0999,458.535,2411.0999,364.935,2402.0999,355.935,1922.3999,355.935" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="2402.0999" x2="2402.0999" y1="355.935" y2="364.935"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="2411.0999" x2="2402.0999" y1="364.935" y2="364.935"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="109.8" x="1927.7999" y="371.4095">forward_message = {</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="388.8" x="1934.9999" y="384.8634">"@type" : "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="133.2" x="1934.9999" y="398.3172">"to"   : "Alice Agent DID",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="150.3" x="1934.9999" y="411.7711">"msg"  : forward_2_message</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="3.6" x="1927.7999" y="425.2249">}</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="0" x="1931.3999" y="438.6788"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="469.8" x="1927.7999" y="452.1327">encrypted_fwd_request = &lt;pack(forward_message, routingKeys[0] == Alice Agency key)&gt;</text><polygon fill="#A80036" points="1076.4,573.5621,1085.4,577.1621,1076.4,580.7621,1080,577.1621" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="920.7" x2="1081.8" y1="577.1621" y2="577.1621"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="144.9" x="927" y="573.7366">forward `encrypted_request`</text><polygon fill="#FBFB77" filter="url(#f77tpco)" points="1091.7,471.712,1091.7,668.812,1534.5,668.812,1534.5,480.712,1525.5,471.712,1091.7,471.712" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1525.5" x2="1525.5" y1="471.712" y2="480.712"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1534.5" x2="1525.5" y1="480.712" y2="480.712"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="56.7" x="1097.1" y="487.1865">request = {</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="131.4" x="1104.3" y="500.6404">"@id": "5678876542345",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="416.7" x="1104.3" y="514.0942">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/didexchange/1.0/request",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="73.8" x="1104.3" y="527.5481">"label": "Bob",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="76.5" x="1104.3" y="541.0019">"connection": {</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="144.9" x="1111.5" y="554.4558">"did": "B.did@B:A",  // alice</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="0" x="1104.3" y="567.9097"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="60.3" x="1125.9" y="567.9097">"did_doc": {</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="190.8" x="1125.9" y="581.3635">"@context": "https://w3id.org/did/v1"</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="0" x="1118.7" y="594.8174"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="133.2" x="1125.9" y="594.8174">// DID Doc contents here.</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="3.6" x="1111.5" y="608.2712">}</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="3.6" x="1104.3" y="621.7251">}</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="3.6" x="1097.1" y="635.1789">}</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="0" x="1100.7" y="648.6328"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="418.5" x="1097.1" y="662.0867">encrypted_request = &lt;pack(request, recipientKeys[0] = Alice Key, B.did@B:A)&gt;</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1087.2" x2="1125" y1="696.0199" y2="696.0199"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1125" x2="1125" y1="696.0199" y2="707.7199"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1088.1" x2="1125" y1="707.7199" y2="707.7199"/><polygon fill="#A80036" points="1097.1,704.1199,1088.1,707.7199,1097.1,711.3199,1093.5,707.7199" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="180" x="1093.5" y="691.7405">stores encrypted_request in queue</text><polygon fill="#A80036" points="1076.4,729.3199,1085.4,732.9199,1076.4,736.5199,1080,732.9199" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="473.4" x2="1081.8" y1="732.9199" y2="732.9199"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="198" x="479.7" y="729.4944">Get all messages {'status': 'Received'}</text><polygon fill="#A80036" points="483.3,755.3738,474.3,758.9738,483.3,762.5738,479.7,758.9738" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="477.9" x2="1086.3" y1="758.9738" y2="758.9738"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="110.7" x="488.7" y="755.5482">[ encrypted_request ]</text><polygon fill="#A80036" points="1076.4,781.4276,1085.4,785.0276,1076.4,788.6276,1080,785.0276" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="473.4" x2="1081.8" y1="785.0276" y2="785.0276"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="100.8" x="479.7" y="781.6021">Updated messages</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="473.4" x2="511.2" y1="811.9353" y2="811.9353"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="511.2" x2="511.2" y1="811.9353" y2="823.6353"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="474.3" x2="511.2" y1="823.6353" y2="823.6353"/><polygon fill="#A80036" points="483.3,820.0353,474.3,823.6353,483.3,827.2353,479.7,823.6353" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="83.7" x="479.7" y="807.6559">process request</text><polygon fill="#FBFB77" filter="url(#f77tpco)" points="100.8,798.9315,100.8,820.5315,465.3,820.5315,465.3,807.9315,456.3,798.9315,100.8,798.9315" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="456.3" x2="456.3" y1="798.9315" y2="807.9315"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="465.3" x2="456.3" y1="807.9315" y2="807.9315"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="345.6" x="106.2" y="814.4059">Alice decrypt `encrypted_request` and generates response for Bob</text><rect fill="#EEEEEE" filter="url(#f77tpco)" height="2.7" style="stroke: #EEEEEE; stroke-width: 0.8999999761581421;" width="2503.7999" x="2.7" y="849.2623"/><line style="stroke: #000000; stroke-width: 0.8999999761581421;" x1="2.7" x2="2506.4999" y1="849.2623" y2="849.2623"/><line style="stroke: #000000; stroke-width: 0.8999999761581421;" x1="2.7" x2="2506.4999" y1="851.9623" y2="851.9623"/><rect fill="#EEEEEE" filter="url(#f77tpco)" height="20.6539" style="stroke: #000000; stroke-width: 1.7999999523162842;" width="138.6" x="1185.3" y="839.8353"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122.4" x="1190.7" y="854.4098">Connection Response</text><polygon fill="#A80036" points="1470.6,928.7508,1479.6,932.3508,1470.6,935.9508,1474.2,932.3508" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="473.4" x2="1476" y1="932.3508" y2="932.3508"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="405.9" x="479.7" y="928.9252">Send `response` to `serviceEndpoint` taken from DIDDoc taken from `request`</text><polygon fill="#FBFB77" filter="url(#f77tpco)" points="1485.9,873.9892,1485.9,976.5892,1978.1999,976.5892,1978.1999,882.9892,1969.1999,873.9892,1485.9,873.9892" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1969.1999" x2="1969.1999" y1="873.9892" y2="882.9892"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1978.1999" x2="1969.1999" y1="882.9892" y2="882.9892"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="109.8" x="1491.3" y="889.4636">forward_message = {</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="385.2" x="1498.5" y="902.9175">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="127.8" x="1498.5" y="916.3714">"to"   : "Bob Agent DID",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="154.8" x="1498.5" y="929.8252">"msg"  :  encrypted_response</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="3.6" x="1491.3" y="943.2791">}</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="0" x="1494.9" y="956.7329"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="473.4" x="1491.3" y="970.1868">encrypted_fwd_response = &lt;pack(forward_message, routingKeys[0] == Bob Agency key)&gt;</text><polygon fill="#A80036" points="1289.7,1105.0701,1280.7,1108.6701,1289.7,1112.2701,1286.1,1108.6701" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1284.3" x2="1480.5" y1="1108.6701" y2="1108.6701"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="153.9" x="1295.1" y="1105.2446">forward `encrypted_response`</text><polygon fill="#FBFB77" filter="url(#f77tpco)" points="1485.9,989.7662,1485.9,1213.8662,2014.1999,1213.8662,2014.1999,998.7662,2005.1999,989.7662,1485.9,989.7662" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="2005.1999" x2="2005.1999" y1="989.7662" y2="998.7662"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="2014.1999" x2="2005.1999" y1="998.7662" y2="998.7662"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="65.7" x="1491.3" y="1005.2406">response = {</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="425.7" x="1498.5" y="1018.6945">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/didexchange/1.0/response",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="175.5" x="1498.5" y="1032.1484">"@id": "12345678900987654321",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="59.4" x="1498.5" y="1045.6022">"~thread": {</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="440.1" x="1505.7" y="1059.0561">"thid": "&lt;The Thread ID is the Message ID (@id) of the first message in the thread&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="1498.5" y="1072.5099">},</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="76.5" x="1498.5" y="1085.9638">"connection": {</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="102.6" x="1505.7" y="1099.4176">"did": "A.did@B:A",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="0" x="1498.5" y="1112.8715"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="60.3" x="1520.1" y="1112.8715">"did_doc": {</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="190.8" x="1512.9" y="1126.3254">"@context": "https://w3id.org/did/v1"</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="133.2" x="1512.9" y="1139.7792">// DID Doc contents here.</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="3.6" x="1505.7" y="1153.2331">}</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="3.6" x="1498.5" y="1166.6869">}</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="3.6" x="1491.3" y="1180.1408">}</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="0" x="1494.9" y="1193.5946"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="509.4" x="1491.3" y="1207.0485">encrypted_response = &lt;pack(response, key for B.did@B:A = Bob Key, A.did@A:B = Alice Key)&gt;</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1279.8" x2="1317.6" y1="1240.9818" y2="1240.9818"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1317.6" x2="1317.6" y1="1240.9818" y2="1252.6818"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1280.7" x2="1317.6" y1="1252.6818" y2="1252.6818"/><polygon fill="#A80036" points="1289.7,1249.0818,1280.7,1252.6818,1289.7,1256.2818,1286.1,1252.6818" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="189" x="1286.1" y="1236.7024">stores encrypted_response in queue</text><polygon fill="#A80036" points="1289.7,1274.2818,1280.7,1277.8818,1289.7,1281.4818,1286.1,1277.8818" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1284.3" x2="1916.9999" y1="1277.8818" y2="1277.8818"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="91.8" x="1295.1" y="1274.4562">Get all messages</text><polygon fill="#A80036" points="1907.0999,1300.3356,1916.0999,1303.9356,1907.0999,1307.5356,1910.6999,1303.9356" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1279.8" x2="1912.4999" y1="1303.9356" y2="1303.9356"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="119.7" x="1286.1" y="1300.5101">[ encrypted_response ]</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1917.8999" x2="1955.6999" y1="1330.8433" y2="1330.8433"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1955.6999" x2="1955.6999" y1="1330.8433" y2="1342.5433"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1918.7999" x2="1955.6999" y1="1342.5433" y2="1342.5433"/><polygon fill="#A80036" points="1927.7999,1338.9433,1918.7999,1342.5433,1927.7999,1346.1433,1924.1999,1342.5433" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="92.7" x="1924.1999" y="1326.5639">process response</text><rect fill="#EEEEEE" filter="url(#f77tpco)" height="2.7" style="stroke: #EEEEEE; stroke-width: 0.8999999761581421;" width="2503.7999" x="2.7" y="1368.1703"/><line style="stroke: #000000; stroke-width: 0.8999999761581421;" x1="2.7" x2="2506.4999" y1="1368.1703" y2="1368.1703"/><line style="stroke: #000000; stroke-width: 0.8999999761581421;" x1="2.7" x2="2506.4999" y1="1370.8703" y2="1370.8703"/><rect fill="#EEEEEE" filter="url(#f77tpco)" height="20.6539" style="stroke: #000000; stroke-width: 1.7999999523162842;" width="36.9" x="1236.15" y="1358.7433"/><text fill="#000000" font-family="sans-serif" font-size="11.7" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="20.7" x="1241.55" y="1373.3178">Ack</text><polygon fill="#A80036" points="930.6,1447.6588,921.6,1451.2588,930.6,1454.8588,927,1451.2588" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="925.2" x2="1916.9999" y1="1451.2588" y2="1451.2588"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="296.1" x="936" y="1447.8332">`ack` message  to `serviceEndpoint` taken from DIDDoc.</text><polygon fill="#FBFB77" filter="url(#f77tpco)" points="1922.3999,1392.8972,1922.3999,1495.4972,2411.0999,1495.4972,2411.0999,1401.8972,2402.0999,1392.8972,1922.3999,1392.8972" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="2402.0999" x2="2402.0999" y1="1392.8972" y2="1401.8972"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="2411.0999" x2="2402.0999" y1="1401.8972" y2="1401.8972"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="109.8" x="1927.7999" y="1408.3716">forward_message = {</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="388.8" x="1934.9999" y="1421.8255">"@type" : "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="133.2" x="1934.9999" y="1435.2794">"to"   : "Alice Agent DID",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="150.3" x="1934.9999" y="1448.7332">"msg"  : forward_2_message</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="3.6" x="1927.7999" y="1462.1871">}</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="0" x="1931.3999" y="1475.6409"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="469.8" x="1927.7999" y="1489.0948">encrypted_fwd_request = &lt;pack(forward_message, routingKeys[0] == Alice Agency key)&gt;</text><polygon fill="#A80036" points="1076.4,1556.7088,1085.4,1560.3088,1076.4,1563.9088,1080,1560.3088" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="920.7" x2="1081.8" y1="1560.3088" y2="1560.3088"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="144.9" x="927" y="1556.8833">forward `encrypted_request`</text><polygon fill="#FBFB77" filter="url(#f77tpco)" points="1091.7,1508.6742,1091.7,1597.7742,1529.1,1597.7742,1529.1,1517.6742,1520.1,1508.6742,1091.7,1508.6742" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1520.1" x2="1520.1" y1="1508.6742" y2="1517.6742"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1529.1" x2="1520.1" y1="1517.6742" y2="1517.6742"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="56.7" x="1097.1" y="1524.1486">request = {</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="369.9" x="1104.3" y="1537.6025">"@type" : "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/ack",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="131.4" x="1104.3" y="1551.0564">"@id": "5678876542345",</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="3.6" x="1097.1" y="1564.5102">}</text><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="0" x="1100.7" y="1577.9641"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="418.5" x="1097.1" y="1591.4179">encrypted_request = &lt;pack(request, recipientKeys[0] = Alice Key, B.did@B:A)&gt;</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1087.2" x2="1125" y1="1625.3512" y2="1625.3512"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1125" x2="1125" y1="1625.3512" y2="1637.0512"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="1088.1" x2="1125" y1="1637.0512" y2="1637.0512"/><polygon fill="#A80036" points="1097.1,1633.4512,1088.1,1637.0512,1097.1,1640.6512,1093.5,1637.0512" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="180" x="1093.5" y="1621.0718">stores encrypted_request in queue</text><polygon fill="#A80036" points="1076.4,1658.6512,1085.4,1662.2512,1076.4,1665.8512,1080,1662.2512" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="473.4" x2="1081.8" y1="1662.2512" y2="1662.2512"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="198" x="479.7" y="1658.8256">Get all messages {'status': 'Received'}</text><polygon fill="#A80036" points="483.3,1684.705,474.3,1688.305,483.3,1691.905,479.7,1688.305" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="477.9" x2="1086.3" y1="1688.305" y2="1688.305"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="110.7" x="488.7" y="1684.8795">[ encrypted_request ]</text><polygon fill="#A80036" points="1076.4,1710.7589,1085.4,1714.3589,1076.4,1717.9589,1080,1714.3589" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="473.4" x2="1081.8" y1="1714.3589" y2="1714.3589"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="100.8" x="479.7" y="1710.9334">Updated messages</text><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="473.4" x2="511.2" y1="1741.2666" y2="1741.2666"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="511.2" x2="511.2" y1="1741.2666" y2="1752.9666"/><line style="stroke: #A80036; stroke-width: 0.8999999761581421;" x1="474.3" x2="511.2" y1="1752.9666" y2="1752.9666"/><polygon fill="#A80036" points="483.3,1749.3666,474.3,1752.9666,483.3,1756.5666,479.7,1752.9666" style="stroke: #A80036; stroke-width: 0.8999999761581421;"/><text fill="#000000" font-family="sans-serif" font-size="11.7" lengthAdjust="spacingAndGlyphs" textLength="83.7" x="479.7" y="1736.9872">process request</text></g></svg>